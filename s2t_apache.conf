<VirtualHost *:443>
    ServerName defintek.io
    ServerAlias www.defintek.io

    # API proxy - must come before static file alias
    ProxyPreserveHost On
    ProxyRequests Off

    <Location /s2t/api>
        ProxyPass http://127.0.0.1:8002/s2t/api
        ProxyPassReverse http://127.0.0.1:8002/s2t/api
    </Location>

    Alias /s2t/static /var/www/defintek.io/public_html/s2t/static
    <Directory /var/www/defintek.io/public_html/s2t/static>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # --- Fix: Exclude /s2t/api from rewrite ---
    RewriteEngine On
    RewriteCond %{REQUEST_URI} ^/s2t/api
    RewriteRule ^ - [L]

    # Serve index.html for all other /s2t routes (React Router)
    RewriteCond %{REQUEST_URI} ^/s2t
    RewriteCond %{REQUEST_URI} !^/s2t/static
    RewriteCond %{REQUEST_URI} !^/s2t/api
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^/s2t(.*)$ /s2t/static/index.html [L]

    # 日誌設置
    ErrorLog ${APACHE_LOG_DIR}/s2t_error.log
    CustomLog ${APACHE_LOG_DIR}/s2t_access.log combined
</VirtualHost> 